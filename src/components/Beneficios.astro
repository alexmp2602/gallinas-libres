---
import IconEgg from "./icons/IconEgg.astro";
import IconLeaf from "./icons/IconLeaf.astro";
import IconFeather from "./icons/IconFeather.astro";
import IconBuildingCommunity from "./icons/IconBuildingCommunity.astro";

const beneficios = [
  {
    icon: IconFeather,
    title: "Bienestar animal",
    description:
      "Gallinas libres, felices y cuidadas con respeto, garantizando un producto de calidad para tu negocio.",
  },
  {
    icon: IconEgg,
    title: "Huevos frescos",
    description:
      "Calidad y sabor garantizados en cada huevo para tus clientes.",
  },
  {
    icon: IconLeaf,
    title: "Sostenibilidad",
    description:
      "Prácticas responsables con el ambiente, cuidando lo que importa a tus consumidores.",
  },
  {
    icon: IconBuildingCommunity,
    title: "Productores locales",
    description:
      "Apoyamos la economía local, trabajando juntos con negocios como el tuyo.",
  },
];
---

<section
  id="beneficios"
  aria-labelledby="beneficios-title"
  class="section bg-white overflow-hidden cv-auto contain-layout"
>
  <div id="beneficiosContent" class="container text-center space-y-8">
    <h2 id="beneficios-title" class="section-title text-orange-800">
      ¿Por qué huevos de gallinas libres?
    </h2>

    <div id="beneficiosGrid" class="grid gap-8 md:grid-cols-2 lg:grid-cols-4">
      {
        beneficios.map((item) => (
          <article class="beneficio-item flex flex-col items-center text-center space-y-2 fade-slide-up" tabindex="0">
            <!-- ícono decorativo con tamaño fijo para evitar CLS -->
            <span aria-hidden="true" class="mb-2 inline-flex h-16 w-16 items-center justify-center">
              <item.icon size={64} color="#9f2d00" width={64} height={64} />
            </span>
            <h3 class="text-lg font-semibold">{item.title}</h3>
            <p class="text-neutral-700 max-w-xs">{item.description}</p>
          </article>
        ))
      }
    </div>
  </div>

  <!-- Reveal progresivo sin librerías (stagger) -->
  <script is:inline>
    (() => {
      const grid = document.getElementById("beneficiosGrid");
      if (!grid) return;

      const items = Array.from(grid.querySelectorAll(".beneficio-item"));
      const showAll = () => {
        items.forEach((el, i) => {
          el.style.transitionDelay = `${i * 60}ms`;
          el.classList.add("show");
        });
      };

      // Respeta reduced motion
      if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
        showAll();
        return;
      }

      const rect = grid.getBoundingClientRect();
      if (rect.top < innerHeight && rect.bottom > 0) {
        showAll();
        return;
      }

      const io = new IntersectionObserver(
        (entries) => {
          if (entries.some(e => e.isIntersecting)) {
            showAll();
            io.disconnect();
          }
        },
        { root: null, rootMargin: "0px 0px -10% 0px", threshold: 0.05 }
      );
      io.observe(grid);
    })();
  </script>
</section>
