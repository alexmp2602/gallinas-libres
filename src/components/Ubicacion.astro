<section
  id="ubicacion"
  aria-labelledby="ubicacion-title"
  class="section bg-white overflow-hidden scroll-mt-12 cv-auto contain-layout"
>
  <div
    class="container mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 text-center space-y-6"
  >
    <h2 id="ubicacion-title" class="section-title text-orange-600">
      ¿Dónde estamos?
    </h2>

    <p
      class="max-w-2xl mx-auto text-base sm:text-lg text-neutral-800 leading-relaxed"
    >
      Estamos en <strong
        >Tranquera 1286, B6614 Goldney, Provincia de Buenos Aires</strong
      >. Abastecemos comercios y mayoristas de la zona con entregas seguras y
      regulares.
    </p>

    <!-- Shell del mapa: estable en altura, sin iframe hasta click -->
    <div
      id="map-shell"
      class="relative w-full h-64 md:h-96 rounded-lg overflow-hidden shadow-md mx-auto bg-neutral-100"
    >
      <!-- Placeholder ligero (podés reemplazar src por /img/maps/goldney.webp si subís una imagen estática) -->
      <div
        class="absolute inset-0 grid place-items-center select-none pointer-events-none"
      >
        <svg
          width="64"
          height="64"
          viewBox="0 0 24 24"
          aria-hidden="true"
          class="opacity-20"
        >
          <path
            fill="currentColor"
            d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7m0 9.5A2.5 2.5 0 1 1 12 6a2.5 2.5 0 0 1 0 5.5Z"
          ></path>
        </svg>
      </div>

      <!-- Botón para cargar el mapa -->
      <button
        id="map-load"
        type="button"
        class="absolute inset-x-0 bottom-4 mx-auto w-[min(90%,320px)] inline-flex items-center justify-center gap-2
               bg-orange-500 text-white font-medium px-4 py-2 rounded-md shadow
               hover:bg-orange-600 active:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2"
        data-url="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3283.584133961065!2d-59.277700025212226!3d-34.61467605807536!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95bc7b0cb77f91b7%3A0x3d38a2a272ef63cd!2sTranquera%201286%2C%20B6614%20Goldney%2C%20Provincia%20de%20Buenos%20Aires!5e0!3m2!1ses-419!2sar!4v1751943759375!5m2!1ses-419!2sar"
        aria-controls="map-shell"
      >
        Ver mapa interactivo
      </button>
    </div>

    <a
      href="https://www.google.com/maps/place/Tranquera+1286,+B6614+Goldney,+Provincia+de+Buenos+Aires"
      target="_blank"
      rel="noopener"
      class="inline-block mt-4 bg-orange-500 text-white font-semibold px-6 py-3 rounded-md shadow
             hover:bg-orange-600 active:bg-orange-700 transition focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2"
    >
      Abrir en Google Maps
    </a>
  </div>

  <script is:inline>
    (() => {
      const btn = document.getElementById("map-load");
      const shell = document.getElementById("map-shell");
      if (!btn || !shell) return;

      const loadIframe = () => {
        if (shell.dataset.loaded) return;
        const url = btn.dataset.url;
        if (!url) return;

        const iframe = document.createElement("iframe");
        iframe.src = url;
        iframe.title = "Mapa: Tranquera 1286, Goldney";
        iframe.loading = "lazy";
        iframe.referrerPolicy = "no-referrer-when-downgrade";
        iframe.allowFullscreen = true;
        iframe.width = "100%";
        iframe.height = "100%";
        iframe.style.border = "0";
        iframe.setAttribute("aria-hidden", "false");

        // Limpio el botón y planto el iframe
        btn.remove();
        shell.appendChild(iframe);
        shell.dataset.loaded = "1";
      };

      // Carga por interacción explícita
      btn.addEventListener("click", loadIframe, { passive: true });

      // Si el usuario ya scrolleó hasta acá y NO está en ahorro de datos, podés auto-cargar al entrar en viewport
      const prefersSaveData =
        navigator.connection && navigator.connection.saveData;
      if (!prefersSaveData) {
        const io = new IntersectionObserver(
          (entries) => {
            if (entries.some((e) => e.isIntersecting)) {
              // Sólo autocarga si el usuario ya interactuó con la página (gesto mínimo)
              if (performance.now() > 3000) loadIframe();
              io.disconnect();
            }
          },
          { rootMargin: "200px 0px" }
        );
        io.observe(shell);
      }
    })();
  </script>

  <noscript>
    <div
      class="relative w-full h-64 md:h-96 rounded-lg overflow-hidden shadow-md mx-auto"
    >
      <iframe
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3283.584133961065!2d-59.277700025212226!3d-34.61467605807536!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95bc7b0cb77f91b7%3A0x3d38a2a272ef63cd!2sTranquera%201286%2C%20B6614%20Goldney%2C%20Provincia%20de%20Buenos%20Aires!5e0!3m2!1ses-419!2sar!4v1751943759375!5m2!1ses-419!2sar"
        width="100%"
        height="100%"
        style="border:0;"
        allowfullscreen=""
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        title="Mapa: Tranquera 1286, Goldney"></iframe>
    </div>
  </noscript>
</section>
